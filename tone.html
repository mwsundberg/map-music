<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Tone Workshop</title>
	<script src = "https://cdnjs.cloudflare.com/ajax/libs/tone/13.0.1/Tone.min.js" ></script>
	<script>
		function midi(note) {
		    return new Tone.Frequency(note, "midi");
		}



		function generateTones() {
		    Tone.Transport.stop();
            let synth = new Tone.Synth().toMaster();

            Tone.Transport._timeline.forEach(function(x) {
                Tone.Transport._timeline.remove(x);
			});




		    let sequence = document.getElementById("sequenceInput").value;
		    let playTime = parseFloat(document.getElementById("lengthInput").value);

		    let elevData = sequence.split(",").map(x => parseFloat(x));
		    console.log(elevData);

		    //ok so we want to assume that each item in elevData represents a point of elevation
			//And that they are roughly equidistant
			//So then we divide the playTime by the number of points and each note plays for that long
			let noteDurationSec = playTime / elevData.length;
			console.log(noteDurationSec);

			let noteSequence = [];
			for(let i=0; i<elevData.length; i++) {
				noteSequence.push(midi(elevData[i]));
			}
			console.log(noteSequence);


			let seq = new Tone.Sequence(function(time, note) {
			    console.log("seq cb");
				synth.triggerAttackRelease(note, noteDurationSec, time);
			}, noteSequence, noteDurationSec).start(0);
			seq.loop = false;

			console.log(seq);






            //part.start(0);
            Tone.Transport.bpm.value = 120;
			Tone.Transport.start();
			Tone.Transport.clear(seq)

		}

        function playCMajorScale(){
            var synth = new Tone.Synth().toMaster();
            var myScale = ['C4','D4','E4','F4','G4','A4','B4','C5'];
            var patternMenu = document.getElementById("melodicPattern");
            var patternName = "up";

            var pattern = new Tone.Pattern(function(time, note){
                //the order of the notes passed in depends on the pattern
                synth.triggerAttackRelease(note, "4n", time);
            }, myScale, patternName).start(0);

            //var tempo = document.myForm.tempo.value;
            Tone.Transport.bpm.value = 120
            //synth.volume.value = document.myForm.volume.value;
            Tone.Transport.start("+0.1");
        }
	</script>
</head>
<body>
<form>
	<p>
		Elevation data sequence (comma sep, no spaces)
		<input type = "text" id="sequenceInput"/>
	</p>
	<p>
		Length (sec)
		<input type="text" id="lengthInput"/>
	</p>

	<input type="button" id="submit" onclick="generateTones()" value="Play Tones" />

</form>
</body>
</html>